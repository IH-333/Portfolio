<!DOCTYPE html>
<html>
    <head>
        <meta charset = "utf-8">
        <link href="style.css" rel="stylesheet">
        <title>福引き</title>
    </head>
    <body>
        <img id = "tree" src = "images/tree.png">
        <audio id="glass">
            <source src="audios/茂みガサガサ.mp3" type="audio/mp3">
        </audio>
        <audio id="bell">
            <source src="audios/クリスマスの鈴.mp3" type="audio/mp3">
        </audio>
        <audio id="end">
            <source src="audios/ジャジャーン.mp3" type="audio/mp3">
        </audio>
        <script>
            let tree = document.getElementById("tree");
            var ball;  //ボールを表示するimgを格納する
            var h1;  //当選差を表示するh1を格納する
            var star;  //星を表示するimgを格納する
            var treeType = 0;  //クリスマスツリーが動いているかを判断する（0：動いていない　1：動いている）
            var name = "ななし";
            //  変更点  //
            var cancel;  //時間経過で初期状態に戻す処理を格納する
            var canEnter = true;  //エンターキーの操作を有効にする
            //////////////
            window.addEventListener('keydown', Tree);  //キー入力を取得
            //  雪のアニメーション  //
            Snow1();
            function Snow1(){
                var body = document.body.style.backgroundImage = "url('images/snow1.gif')";
                setTimeout(Snow2,4500);
            }
            function Snow2(){
                var body = document.body.style.backgroundImage = "url('images/snow2.gif')";
            }
            //  クリスマスツリーのアニメーション  //
            function Tree(e){
                if(e.key === "Enter" && treeType == 0 && canEnter == true){
                    document.getElementById("glass").play();  //変更点
                    document.getElementById("glass").loop = true;  //変更点
                    document.getElementById("bell").play();  //変更点
                    document.getElementById("bell").loop = true;  //変更点
                    if(cancel) clearTimeout(cancel);  //変更点
                    tree.src = "images/tree.gif";
                    // if(ball != null) ball.remove();
                    if(ball != null) {
                        ball.src = "";
                        ball.id = "ball_after";
                    }
                    if(h1 != null) {
                        h1.remove();
                        h1.id = "h1_after";
                    }
                    if(star != null) {
                        star.src = "";
                        star.id = "star.after";
                    }
                    treeType = 1;
                }
                else if(e.key === "Enter" && treeType == 1 && canEnter == true){
                    setTimeout(() => {
                        document.getElementById("glass").pause();  //変更点
                        document.getElementById("bell").pause();  //変更点
                        canEnter = false;  //変更点
                        tree.src = "images/tree2.png";
                        ball = document.createElement("img");
                        ball.id = "ball";
                        ball.src = "images/ball.gif";
                        ball.width = "1200";
                        ball.height = "700";
                        document.body.appendChild(ball);
                        setTimeout(Result,3000);
                        treeType = 0;
                    },1000)
                }
            }
            function Result(){
                //tree.src = "images/tree4.png";
                document.getElementById("end").play();
                h1 = document.createElement("h1");
                h1.id = "h1";
                h1.innerHTML = name + "様<br>おめでとうございます！";
                document.body.appendChild(h1); 
                Star();
            }
            function Star(){
                star = document.createElement("img");
                star.id = "star";
                star.src = "images/star.gif";
                star.width = "1000";
                star.height = "500";
                document.body.appendChild(star);
                canEnter = true;  //変更点
                cancel = setTimeout(Reset,10000);　//時間経過で最初の場面に戻らせる処理  //変更点
            }
            //  変更点  //
            function Reset(){
                tree.src = "images/tree.png";
                // if(ball != null) ball.remove();
                if(ball != null) ball.remove();
                if(h1 != null) h1.remove();
                if(star != null) star.remove();
            }
            //////////////
        </script>


    </body>
</html>